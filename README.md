# Solana Shinobi Mod Patch

Оптимизация голосования валидаторов для Solana v2.2.12.

## Описание

Этот мод-патч оптимизирует процесс голосования валидаторов Solana, позволяя:
- Настраивать пороговые значения для голосования
- Использовать backfill голосов для увеличения кредитов
- Отключать истечение голосов для оптимизации кредитов
- Добавлять логику после пропусков слотов
- Предотвращать слишком длинные блокировки

## Применение

```bash
# Находясь в директории solana v2.2.12
git apply shinobi_mod_v2.2.12.patch
```

## Конфигурация

Создайте файл `mostly_confirmed_threshold` в корневой директории валидатора с четырьмя числами, разделенными пробелами:

```
0.45 4 0 24
```

Где:
1. `0.45` - порог "почти подтверждения" слота (доля взвешенных голосов)
2. `4` - количество слотов вперед от последнего "почти подтвержденного" слота
3. `0` - поведение после пропусков слотов (0 - обычное, 1 - требуется пороговое значение, 2 - требуется консенсус)
4. `24` - количество слотов без голосования, после которого активируется "аварийный выход"

## Принцип работы

1. **Определение "почти подтвержденных" слотов**:
   - Слот считается "почти подтвержденным", если за него проголосовало больше `mostly_confirmed_threshold` от общего веса стейка (например, >45%).

2. **Правила голосования**:
   - Валидатор голосует за "почти подтвержденные" слоты
   - Валидатор может голосовать за слоты, находящиеся не дальше чем `threshold_ahead_count` от последнего "почти подтвержденного" слота
   - После пропуска слота применяется специальная логика в зависимости от значения `after_skip_threshold`
   - Если валидатор не голосовал в течение `threshold_escape_count` слотов, активируется "аварийный выход" и валидатор голосует за любой слот

3. **Backfill голосов**:
   - При голосовании за слот, расположенный через несколько слотов от последнего проголосованного, мод автоматически заполняет промежуточные слоты
   - Это увеличивает количество кредитов за голосование без увеличения риска

## Примечания

- Если файл конфигурации отсутствует, мод не влияет на поведение валидатора
- Конфигурация перечитывается каждую минуту, позволяя менять настройки без перезапуска
- Рекомендуемые значения: 0.45 4 0 24
- Мод разработан для версии Solana 2.2.12, для других версий может потребоваться адаптация
